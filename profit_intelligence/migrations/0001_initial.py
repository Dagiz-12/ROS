# Generated by Django 5.2.1 on 2026-01-16 12:47

import django.core.validators
import django.db.models.deletion
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('inventory', '0001_initial'),
        ('menu', '0002_menuitem_cost_price_menuitem_last_sold_and_more'),
        ('restaurants', '0001_initial'),
        ('tables', '0002_order_inventory_deducted'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='MenuItemPerformance',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('performance_id', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),
                ('date', models.DateField()),
                ('quantity_sold', models.IntegerField(default=0, validators=[django.core.validators.MinValueValidator(0)])),
                ('revenue', models.DecimalField(decimal_places=2, default=0, max_digits=10, validators=[django.core.validators.MinValueValidator(0)])),
                ('ingredient_cost', models.DecimalField(decimal_places=2, default=0, max_digits=10, validators=[django.core.validators.MinValueValidator(0)])),
                ('labor_cost_share', models.DecimalField(decimal_places=2, default=0, max_digits=10, validators=[django.core.validators.MinValueValidator(0)])),
                ('total_cost', models.DecimalField(decimal_places=2, default=0, max_digits=10, validators=[django.core.validators.MinValueValidator(0)])),
                ('gross_profit', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('net_profit', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('profit_margin', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('revenue_rank', models.IntegerField(default=0)),
                ('profit_rank', models.IntegerField(default=0)),
                ('margin_rank', models.IntegerField(default=0)),
                ('previous_day_quantity', models.IntegerField(default=0)),
                ('quantity_change', models.IntegerField(default=0)),
                ('trend', models.CharField(choices=[('up', 'Increasing'), ('down', 'Decreasing'), ('stable', 'Stable'), ('new', 'New Item')], default='stable', max_length=20)),
                ('calculated_at', models.DateTimeField(auto_now=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('branch', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='restaurants.branch')),
                ('menu_item', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='performance_records', to='menu.menuitem')),
                ('restaurant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='restaurants.restaurant')),
            ],
            options={
                'verbose_name': 'Menu Item Performance',
                'verbose_name_plural': 'Menu Item Performances',
                'ordering': ['date', '-revenue'],
                'indexes': [models.Index(fields=['date', 'menu_item'], name='profit_inte_date_b3397d_idx'), models.Index(fields=['menu_item', 'date'], name='profit_inte_menu_it_8208ce_idx'), models.Index(fields=['profit_margin'], name='profit_inte_profit__d304d4_idx'), models.Index(fields=['revenue_rank', 'date'], name='profit_inte_revenue_7b049d_idx'), models.Index(fields=['profit_rank', 'date'], name='profit_inte_profit__a3c00e_idx')],
                'unique_together': {('date', 'menu_item', 'restaurant', 'branch')},
            },
        ),
        migrations.CreateModel(
            name='PriceOptimization',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('optimization_id', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),
                ('status', models.CharField(choices=[('pending', 'Pending Review'), ('approved', 'Approved for Implementation'), ('rejected', 'Rejected'), ('implemented', 'Implemented'), ('expired', 'Expired (Market Changed)')], default='pending', max_length=20)),
                ('current_price', models.DecimalField(decimal_places=2, max_digits=10, validators=[django.core.validators.MinValueValidator(0)])),
                ('current_cost', models.DecimalField(decimal_places=2, max_digits=10, validators=[django.core.validators.MinValueValidator(0)])),
                ('current_margin', models.DecimalField(decimal_places=2, max_digits=5)),
                ('current_demand', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('suggested_price', models.DecimalField(decimal_places=2, max_digits=10, validators=[django.core.validators.MinValueValidator(0)])),
                ('projected_margin', models.DecimalField(decimal_places=2, max_digits=5)),
                ('price_change_percent', models.DecimalField(decimal_places=2, max_digits=5)),
                ('confidence_score', models.DecimalField(decimal_places=2, default=0.5, max_digits=3)),
                ('algorithm_version', models.CharField(default='v1.0', max_length=50)),
                ('features_used', models.JSONField(blank=True, default=list)),
                ('reason', models.TextField()),
                ('key_factors', models.JSONField(blank=True, default=list)),
                ('projected_demand_change', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('projected_revenue_change', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('projected_profit_change', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('projected_roi', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('competitor_price', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('market_average_price', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('is_applied', models.BooleanField(default=False)),
                ('applied_at', models.DateTimeField(blank=True, null=True)),
                ('applied_actual_price', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('actual_margin_after', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('actual_demand_after', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('actual_profit_change', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('valid_until', models.DateTimeField(blank=True, null=True)),
                ('applied_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='applied_optimizations', to=settings.AUTH_USER_MODEL)),
                ('menu_item', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='price_optimizations', to='menu.menuitem')),
                ('restaurant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='restaurants.restaurant')),
            ],
            options={
                'verbose_name': 'Price Optimization',
                'verbose_name_plural': 'Price Optimizations',
                'ordering': ['-confidence_score', '-projected_profit_change'],
                'indexes': [models.Index(fields=['menu_item', 'status'], name='profit_inte_menu_it_4a85b7_idx'), models.Index(fields=['restaurant', 'created_at'], name='profit_inte_restaur_f200bc_idx'), models.Index(fields=['confidence_score'], name='profit_inte_confide_d4620d_idx'), models.Index(fields=['projected_profit_change'], name='profit_inte_project_ec1071_idx')],
            },
        ),
        migrations.CreateModel(
            name='ProfitAggregation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('aggregation_id', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),
                ('level', models.CharField(choices=[('daily', 'Daily'), ('weekly', 'Weekly'), ('monthly', 'Monthly')], max_length=20)),
                ('date', models.DateField()),
                ('revenue', models.DecimalField(decimal_places=2, default=0, max_digits=12, validators=[django.core.validators.MinValueValidator(0)])),
                ('cost_of_goods', models.DecimalField(decimal_places=2, default=0, max_digits=12, validators=[django.core.validators.MinValueValidator(0)])),
                ('labor_cost', models.DecimalField(decimal_places=2, default=0, max_digits=12, validators=[django.core.validators.MinValueValidator(0)])),
                ('overhead_cost', models.DecimalField(decimal_places=2, default=0, max_digits=12, validators=[django.core.validators.MinValueValidator(0)])),
                ('total_cost', models.DecimalField(decimal_places=2, default=0, max_digits=12, validators=[django.core.validators.MinValueValidator(0)])),
                ('gross_profit', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('net_profit', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('profit_margin', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('order_count', models.IntegerField(default=0, validators=[django.core.validators.MinValueValidator(0)])),
                ('customer_count', models.IntegerField(default=0, validators=[django.core.validators.MinValueValidator(0)])),
                ('average_order_value', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('table_turnover', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('waste_cost', models.DecimalField(decimal_places=2, default=0, max_digits=10, validators=[django.core.validators.MinValueValidator(0)])),
                ('waste_percentage', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('top_wasted_items', models.JSONField(blank=True, default=dict)),
                ('is_above_target', models.BooleanField(default=False)),
                ('has_issues', models.BooleanField(default=False)),
                ('data_quality_score', models.DecimalField(decimal_places=2, default=1.0, max_digits=3)),
                ('calculated_at', models.DateTimeField(auto_now=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('branch', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='restaurants.branch')),
                ('restaurant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='restaurants.restaurant')),
            ],
            options={
                'verbose_name': 'Profit Aggregation',
                'verbose_name_plural': 'Profit Aggregations',
                'ordering': ['-date', '-level'],
                'indexes': [models.Index(fields=['date', 'restaurant'], name='profit_inte_date_e09d45_idx'), models.Index(fields=['restaurant', 'branch', 'level', 'date'], name='profit_inte_restaur_e009a1_idx'), models.Index(fields=['profit_margin'], name='profit_inte_profit__b1ca67_idx'), models.Index(fields=['has_issues'], name='profit_inte_has_iss_45bbda_idx')],
                'unique_together': {('level', 'date', 'restaurant', 'branch')},
            },
        ),
        migrations.CreateModel(
            name='ProfitAlert',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('alert_id', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),
                ('alert_type', models.CharField(choices=[('low_margin', 'Low Profit Margin (< 15%)'), ('loss_maker', 'Selling at Loss'), ('price_adjustment', 'Price Adjustment Suggested'), ('waste_spike', 'Waste Cost Spike (> 10%)'), ('demand_drop', 'Significant Demand Drop'), ('cost_increase', 'Ingredient Cost Increased'), ('performance_drop', 'Performance Drop'), ('inventory_shortage', 'Inventory Affecting Sales')], max_length=30)),
                ('severity', models.CharField(choices=[('critical', 'Critical (Immediate Action)'), ('high', 'High (Address Today)'), ('medium', 'Medium (Address This Week)'), ('low', 'Low (Monitor)'), ('info', 'Informational')], default='MEDIUM', max_length=20)),
                ('title', models.CharField(max_length=200)),
                ('message', models.TextField()),
                ('details', models.JSONField(blank=True, default=dict)),
                ('current_value', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('threshold', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('deviation', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('is_resolved', models.BooleanField(default=False)),
                ('resolved_at', models.DateTimeField(blank=True, null=True)),
                ('resolution_notes', models.TextField(blank=True)),
                ('auto_resolve', models.BooleanField(default=False)),
                ('auto_resolve_condition', models.JSONField(blank=True, default=dict)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('acknowledged_at', models.DateTimeField(blank=True, null=True)),
                ('acknowledged_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='acknowledged_alerts', to=settings.AUTH_USER_MODEL)),
                ('branch', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='restaurants.branch')),
                ('menu_item', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='profit_alerts', to='menu.menuitem')),
                ('order', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='profit_alerts', to='tables.order')),
                ('resolved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='resolved_alerts', to=settings.AUTH_USER_MODEL)),
                ('restaurant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='restaurants.restaurant')),
                ('stock_item', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='profit_alerts', to='inventory.stockitem')),
            ],
            options={
                'verbose_name': 'Profit Alert',
                'verbose_name_plural': 'Profit Alerts',
                'ordering': ['-severity', '-created_at'],
                'indexes': [models.Index(fields=['alert_type', 'is_resolved'], name='profit_inte_alert_t_88bafd_idx'), models.Index(fields=['severity', 'created_at'], name='profit_inte_severit_8d75b5_idx'), models.Index(fields=['menu_item', 'is_resolved'], name='profit_inte_menu_it_d0c370_idx'), models.Index(fields=['restaurant', 'branch', 'is_resolved'], name='profit_inte_restaur_1bb94f_idx')],
            },
        ),
        migrations.CreateModel(
            name='ProfitReport',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('report_id', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),
                ('date', models.DateField()),
                ('report_type', models.CharField(default='daily', max_length=50)),
                ('data', models.JSONField()),
                ('summary', models.TextField(blank=True)),
                ('generated_at', models.DateTimeField(auto_now_add=True)),
                ('emailed_to', models.JSONField(blank=True, default=list)),
                ('emailed_at', models.DateTimeField(blank=True, null=True)),
                ('is_archived', models.BooleanField(default=False)),
                ('branch', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='restaurants.branch')),
                ('generated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('restaurant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='restaurants.restaurant')),
            ],
            options={
                'verbose_name': 'Profit Report',
                'verbose_name_plural': 'Profit Reports',
                'ordering': ['-date', '-generated_at'],
                'indexes': [models.Index(fields=['date', 'restaurant'], name='profit_inte_date_f7217e_idx'), models.Index(fields=['restaurant', 'branch', 'report_type'], name='profit_inte_restaur_f4f08d_idx')],
            },
        ),
    ]
