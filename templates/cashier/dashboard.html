<!-- templates/cashier/dashboard.html - MODIFIED HEAD SECTION -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Payment System - Cashier Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Custom CSS -->
    <link href="/static/css/styles.css" rel="stylesheet" />

    <style>
      /* Keep only essential styles */
      .payment-card {
        transition: all 0.3s ease;
      }
      .payment-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      .status-unpaid {
        border-left: 4px solid #ef4444;
      }
      .status-partial {
        border-left: 4px solid #f59e0b;
      }
      .status-paid {
        border-left: 4px solid #10b981;
      }
      .payment-method-cash {
        background-color: #f0f9ff;
      }
      .payment-method-card {
        background-color: #fef7ff;
      }
      .payment-method-mobile {
        background-color: #f0fdf4;
      }
      .receipt {
        font-family: "Courier New", monospace;
        background: white;
        color: black;
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg px-4 py-3 flex items-center justify-between">
      <div class="flex items-center space-x-4">
        <a href="/" class="text-gray-800 font-semibold">ROS</a>
        <span class="text-gray-600 text-sm">Cashier</span>
      </div>
      <div class="flex items-center space-x-3">
        <div class="text-sm text-gray-700 mr-4">
          Signed in as <strong id="cashierNameNav">{{ user.username }}</strong>
        </div>
        <button
          id="logout-btn"
          onclick="logout()"
          class="px-3 py-2 bg-red-600 hover:bg-red-700 rounded text-sm text-white"
        >
          Logout
        </button>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-6">
      <div class="flex items-start gap-6">
        <!-- Left: Pending bills -->
        <div class="w-2/3 bg-white rounded shadow p-4">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold">Pending Bills</h2>
            <div class="flex items-center gap-2">
              <select id="table-filter" class="px-2 py-1 border rounded">
                <option value="all">All Tables</option>
              </select>
              <button
                id="refresh-btn"
                class="px-3 py-1 bg-blue-600 text-white rounded"
              >
                Refresh
              </button>
              <button
                id="cash-drawer-btn"
                class="px-3 py-1 bg-gray-200 rounded"
              >
                Open Drawer
              </button>
            </div>
          </div>

          <div id="pending-bills" class="space-y-3 min-h-[300px]">
            <!-- Bill cards rendered here -->
          </div>
        </div>

        <!-- Right: Selected bill & actions -->
        <div class="w-1/3">
          <div class="bg-white rounded shadow p-4 mb-4">
            <h3 class="font-semibold">Selected Bill</h3>
            <div
              id="selected-bill-container"
              class="mt-3 text-sm text-gray-600"
            >
              <div class="text-center py-8 text-gray-500">
                <i class="fas fa-receipt text-3xl mb-3"></i>
                <p>No bill selected</p>
                <p class="text-sm">Select a bill from the left</p>
              </div>
            </div>
          </div>

          <div
            id="payment-interface"
            class="bg-white rounded shadow p-4 hidden"
          >
            <h4 class="font-semibold">Process Payment</h4>
            <div class="mt-3 space-y-2">
              <div class="flex justify-between text-sm">
                <span>Subtotal</span>
                <span id="bill-subtotal">$0.00</span>
              </div>
              <div class="flex justify-between text-sm">
                <span>Tax</span>
                <span id="bill-tax">$0.00</span>
              </div>
              <div class="flex justify-between text-sm">
                <span>Service</span>
                <span id="bill-service">$0.00</span>
              </div>
              <div class="flex justify-between text-sm font-bold border-t pt-2">
                <span>Total</span>
                <span id="bill-total">$0.00</span>
              </div>
              <div class="flex justify-between text-sm">
                <span>Paid</span>
                <span id="bill-paid">$0.00</span>
              </div>
              <div class="flex justify-between text-sm">
                <span>Balance</span>
                <span id="bill-balance">$0.00</span>
              </div>

              <div class="mt-3">
                <div class="flex gap-2 mb-2">
                  <button class="payment-method-btn" data-method="cash">
                    Cash
                  </button>
                  <button class="payment-method-btn" data-method="card">
                    Card
                  </button>
                  <button class="payment-method-btn" data-method="mobile">
                    Mobile
                  </button>
                </div>

                <div class="flex gap-2 mb-2">
                  <button data-amount="5" class="px-2 py-1 bg-gray-100 rounded">
                    + $5
                  </button>
                  <button
                    data-amount="10"
                    class="px-2 py-1 bg-gray-100 rounded"
                  >
                    + $10
                  </button>
                  <button
                    data-amount="20"
                    class="px-2 py-1 bg-gray-100 rounded"
                  >
                    + $20
                  </button>
                </div>

                <input
                  id="amount-received"
                  type="number"
                  step="0.01"
                  placeholder="Amount received"
                  class="w-full px-2 py-1 border rounded"
                />

                <div id="change-container" class="mt-2 hidden">
                  Change: <span id="change-amount">$0.00</span>
                </div>

                <div class="mt-3">
                  <button
                    id="process-payment-btn"
                    class="px-4 py-2 bg-green-600 text-white rounded"
                    disabled
                  >
                    Process Payment
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="bg-white rounded shadow p-4 mt-4">
            <h4 class="font-semibold">Today</h4>
            <div class="mt-2 text-sm text-gray-700">
              <div class="flex justify-between">
                <span>Pending payments</span
                ><span id="pending-payments">0</span>
              </div>
              <div class="flex justify-between">
                <span>Today revenue</span><span id="today-revenue">$0.00</span>
              </div>
              <div class="flex justify-between">
                <span>Card</span><span id="card-payments">0</span>
              </div>
              <div class="flex justify-between">
                <span>Mobile</span><span id="mobile-payments">0</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-6 bg-white rounded shadow p-4">
        <h3 class="font-semibold mb-2">Recent Transactions</h3>
        <div class="overflow-auto">
          <table class="w-full text-sm">
            <thead>
              <tr class="text-left text-gray-600">
                <th class="px-4 py-2">Time</th>
                <th class="px-4 py-2">Table</th>
                <th class="px-4 py-2">Amount</th>
                <th class="px-4 py-2">Method</th>
                <th class="px-4 py-2">Status</th>
              </tr>
            </thead>
            <tbody id="recent-transactions">
              <!-- Recent transactions rows inserted here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Receipt Modal -->
    <div
      id="receipt-modal"
      class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden"
    >
      <!-- Modal content will be filled by JS -->
    </div>

    <!-- Hidden user data for JS -->
    <div
      id="user-data"
      data-user='{"username": "{{ user.username }}", "role": "{{ user.role }}"}'
    ></div>

    <!-- Toast container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- External JavaScript -->
    <script src="/static/js/auth-manager.js"></script>
    <script src="/static/js/cashier-dashboard.js"></script>

    <script>
      // Minimal initialization script
      document.addEventListener("DOMContentLoaded", function () {
        // Update buttons with proper IDs and data attributes
        const refreshBtn = document.querySelector('button[onclick*="refresh"]');
        if (refreshBtn) {
          refreshBtn.id = "refresh-btn";
          refreshBtn.removeAttribute("onclick");
        }

        const cashDrawerBtn = document.querySelector(
          'button[onclick*="openCashDrawer"]'
        );
        if (cashDrawerBtn) {
          cashDrawerBtn.id = "cash-drawer-btn";
          cashDrawerBtn.removeAttribute("onclick");
        }

        // Update payment method buttons
        document
          .querySelectorAll('[onclick*="selectPaymentMethod"]')
          .forEach((btn) => {
            const method = btn.onclick
              .toString()
              .match(/selectPaymentMethod\('(.*)'\)/)[1];
            btn.dataset.method = method;
            btn.classList.add("payment-method-btn");
            btn.removeAttribute("onclick");
          });

        // Update quick amount buttons
        document.querySelectorAll('[onclick*="addAmount"]').forEach((btn) => {
          const amount = btn.onclick.toString().match(/addAmount\((\d+)\)/)[1];
          btn.dataset.amount = amount;
          btn.removeAttribute("onclick");
        });

        // Update view buttons
        document
          .querySelectorAll('[onclick*="viewBillDetails"]')
          .forEach((btn) => btn.removeAttribute("onclick"));

        // Update process payment button
        const processBtn = document.querySelector(
          '[onclick*="processPayment"]'
        );
        if (processBtn) {
          processBtn.id = "process-payment-btn";
          processBtn.removeAttribute("onclick");
        }

        // Update print receipt button
        const printBtn = document.querySelector('[onclick*="printReceipt"]');
        if (printBtn) {
          printBtn.id = "print-receipt-btn";
          printBtn.removeAttribute("onclick");
        }

        // Remove onclick from bill selection
        document
          .querySelectorAll('[onclick*="selectBill"]')
          .forEach((el) => el.removeAttribute("onclick"));

        console.log("Cashier template initialized for external JS");
      });
    </script>
  </body>
</html>
